"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React);function _process(e,t){var r,n;if("function"==typeof t)void 0!==(n=t(e))&&(e=n);else if(Array.isArray(t))for(r=0;r<t.length;r++)void 0!==(n=t[r](e))&&(e=n);return e}function parseKey(e,t){return"-"===e[0]&&Array.isArray(t)&&/^-\d+$/.test(e)?t.length+parseInt(e,10):e}function isIndex(e){return/^\d+$/.test(e)}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function isArrayOrObject(e){return Object(e)===e}function isEmptyObject(e){return 0===Object.keys(e).length}function parsePath(e,t){return e.indexOf("[")>=0&&(e=e.replace(/\[/g,".").replace(/]/g,"")),e.split(t)}function DotObject(e,t,r){if(!(this instanceof DotObject))return new DotObject(e,t,r);void 0===t&&(t=!1),void 0===r&&(r=!0),this.separator=e||".",this.override=t,this.useArray=r,this.keepArray=!1,this.cleanup=[]}var dotDefault=new DotObject(".",!1,!0);function wrap(e){return function(){return dotDefault[e].apply(dotDefault,arguments)}}DotObject.prototype._fill=function(e,t,r,n){var a=e.shift();if(e.length>0){if(t[a]=t[a]||(this.useArray&&isIndex(e[0])?[]:{}),!isArrayOrObject(t[a])){if(!this.override){if(!isArrayOrObject(r)||!isEmptyObject(r))throw new Error("Trying to redefine `"+a+"` which is a "+typeof t[a]);return}t[a]={}}this._fill(e,t[a],r,n)}else{if(!this.override&&isArrayOrObject(t[a])&&!isEmptyObject(t[a])){if(!isArrayOrObject(r)||!isEmptyObject(r))throw new Error("Trying to redefine non-empty obj['"+a+"']");return}t[a]=_process(r,n)}},DotObject.prototype.object=function(e,t){var r=this;return Object.keys(e).forEach(function(n){var a=void 0===t?null:t[n],i=parsePath(n,r.separator).join(r.separator);-1!==i.indexOf(r.separator)?(r._fill(i.split(r.separator),e,e[n],a),delete e[n]):r.override&&(e[n]=_process(e[n],a))}),e},DotObject.prototype.str=function(e,t,r,n){return-1!==e.indexOf(this.separator)?this._fill(e.split(this.separator),r,t,n):r.hasOwnProperty(e)&&!this.override||(r[e]=_process(t,n)),r},DotObject.prototype.pick=function(e,t,r){var n,a,i,o,c;for(a=parsePath(e,this.separator),n=0;n<a.length;n++){if(o=parseKey(a[n],t),!(t&&"object"==typeof t&&o in t))return;if(n===a.length-1)return r?(i=t[o],delete t[o],Array.isArray(t)&&(c=a.slice(0,-1).join("."),-1===this.cleanup.indexOf(c)&&this.cleanup.push(c)),i):t[o];t=t[o]}return r&&Array.isArray(t)&&(t=t.filter(function(e){return void 0!==e})),t},DotObject.prototype.remove=function(e,t){var r;if(this.cleanup=[],Array.isArray(e)){for(r=0;r<e.length;r++)this.pick(e[r],t,!0);return this._cleanup(t),t}return this.pick(e,t,!0)},DotObject.prototype._cleanup=function(e){var t,r,n,a;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)t=(t=(a=(n=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(a,e):e)[n[0]].filter(function(e){return void 0!==e}),this.set(this.cleanup[r],t,e);this.cleanup=[]}},DotObject.prototype.del=DotObject.prototype.remove,DotObject.prototype.move=function(e,t,r,n,a){return"function"==typeof n||Array.isArray(n)?this.set(t,_process(this.pick(e,r,!0),n),r,a):(a=n,this.set(t,this.pick(e,r,!0),r,a)),r},DotObject.prototype.transfer=function(e,t,r,n,a,i){return"function"==typeof a||Array.isArray(a)?this.set(t,_process(this.pick(e,r,!0),a),n,i):(i=a,this.set(t,this.pick(e,r,!0),n,i)),n},DotObject.prototype.copy=function(e,t,r,n,a,i){return"function"==typeof a||Array.isArray(a)?this.set(t,_process(JSON.parse(JSON.stringify(this.pick(e,r,!1))),a),n,i):(i=a,this.set(t,this.pick(e,r,!1),n,i)),n},DotObject.prototype.set=function(e,t,r,n){var a,i,o,c;if(void 0===t)return r;for(o=parsePath(e,this.separator),a=0;a<o.length;a++){if(c=o[a],a===o.length-1)if(n&&isObject(t)&&isObject(r[c]))for(i in t)t.hasOwnProperty(i)&&(r[c][i]=t[i]);else if(n&&Array.isArray(r[c])&&Array.isArray(t))for(var l=0;l<t.length;l++)r[o[a]].push(t[l]);else r[c]=t;else r.hasOwnProperty(c)&&(isObject(r[c])||Array.isArray(r[c]))||(/^\d+$/.test(o[a+1])?r[c]=[]:r[c]={});r=r[c]}return r},DotObject.prototype.transform=function(e,t,r){return t=t||{},r=r||{},Object.keys(e).forEach(function(n){this.set(e[n],this.pick(n,t),r)}.bind(this)),r},DotObject.prototype.dot=function(e,t,r){return t=t||{},r=r||[],Object.keys(e).forEach(function(n){if(isArrayOrObject(e[n])&&(isObject(e[n])&&!isEmptyObject(e[n])||Array.isArray(e[n])&&!this.keepArray&&0!==e[n].length))return this.dot(e[n],t,r.concat(n));t[r.concat(n).join(this.separator)]=e[n]}.bind(this)),t},DotObject.pick=wrap("pick"),DotObject.move=wrap("move"),DotObject.transfer=wrap("transfer"),DotObject.transform=wrap("transform"),DotObject.copy=wrap("copy"),DotObject.object=wrap("object"),DotObject.str=wrap("str"),DotObject.set=wrap("set"),DotObject.del=DotObject.remove=wrap("remove"),DotObject.dot=wrap("dot"),["override","overwrite"].forEach(function(e){Object.defineProperty(DotObject,e,{get:function(){return dotDefault.override},set:function(e){dotDefault.override=!!e}})}),["useArray","keepArray"].forEach(function(e){Object.defineProperty(DotObject,e,{get:function(){return dotDefault[e]},set:function(t){dotDefault[e]=t}})}),DotObject._process=_process;var dotObject=DotObject,FormContext=React.createContext({initialData:{},errors:{},scopePath:"",registerField:function(){},unregisterField:function(){}});function useField(e){var t=React.useContext(FormContext),r=t.initialData,n=t.errors,a=t.scopePath,i=t.unregisterField,o=t.registerField,c=a?a+"."+e:e;React.useEffect(function(){return function(){return i(c)}},[c]);var l=dotObject.pick(c,r),u=n[c];return{fieldName:c,registerField:o,defaultValue:l,error:u}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&(r[n[a]]=e[n[a]])}return r}function __awaiter(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(o,c)}l((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function Form(e){var t=e.initialData,r=void 0===t?{}:t,n=e.children,a=e.schema,i=e.context,o=void 0===i?{}:i,c=e.onSubmit,l=__rest(e,["initialData","children","schema","context","onSubmit"]),u=React.useState({}),s=u[0],f=u[1],p=React.useState([]),d=p[0],h=p[1];function _(e){void 0===e&&(e={}),d.forEach(function(t){var r=t.name,n=t.ref,a=t.path,i=t.clearValue;return i?i(n,e[r]):dotObject.set(a,e[r]?e[r]:"",n)})}var b=React.useCallback(function(e){h(function(t){return t.concat([e])})},[]),m=React.useCallback(function(e){h(function(t){return t.filter(function(t){return t.name!==e})})},[]);return React__default.createElement(FormContext.Provider,{value:{initialData:r,errors:s,scopePath:"",registerField:b,unregisterField:m}},React__default.createElement("form",__assign({},l,{"data-testid":"form",onSubmit:function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:e.preventDefault(),t=function(){var e={};return d.forEach(function(t){var r=t.name,n=t.ref,a=t.path,i=t.parseValue,o=dotObject.pick(a,n);e[r]=i?i(n):o}),dotObject.object(e),e}(),i.label=1;case 1:return i.trys.push([1,4,,5]),a?[4,a.validate(t,{abortEarly:!1,stripUnknown:!0,context:o})]:[3,3];case 2:i.sent(),t=a.cast(t,{stripUnknown:!0,context:o}),i.label=3;case 3:return f({}),c(t,{resetForm:_}),[3,5];case 4:if(r=i.sent(),n={},!r.inner)throw r;return r.inner.forEach(function(e){n[e.path]=e.message}),f(n),[3,5];case 5:return[2]}})})}}),n))}function Scope(e){var t=e.path,r=e.children,n=React.useContext(FormContext),a=n.scopePath,i=__rest(n,["scopePath"]);return React__default.createElement(FormContext.Provider,{value:__assign({},i,{scopePath:a.concat(a?"."+t:t)})},r)}function Input(e){var t=e.name,r=e.label,n=e.multiline,a=void 0!==n&&n,i=__rest(e,["name","label","multiline"]),o=React.useRef(null),c=useField(t),l=c.fieldName,u=c.registerField,s=c.defaultValue,f=c.error;React.useEffect(function(){o.current&&u({name:l,ref:o.current,path:"value"})},[o.current,l]);var p=__assign({},i,{ref:o,id:l,name:l,"aria-label":l,defaultValue:s});return React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:l},r),a?React__default.createElement("textarea",__assign({},p)):React__default.createElement("input",__assign({},p)),f&&React__default.createElement("span",null,f))}function Textarea(e){return React.useEffect(function(){console.warn("Textarea will be deprecated in the next major unform release. Please use <Input multiline /> instead")},[]),React__default.createElement(Input,__assign({},e,{multiline:!0}))}var defaultProps={placeholder:"",defaultValue:""};function Select(e){var t=e.name,r=e.label,n=e.placeholder,a=e.defaultValue,i=e.options,o=__rest(e,["name","label","placeholder","defaultValue","options"]),c=React.useRef(null),l=useField(t),u=l.fieldName,s=l.registerField,f=l.defaultValue,p=l.error;return React.useEffect(function(){c.current&&s({name:u,ref:c.current,path:"value"})},[c.current,u]),React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:u},r),React__default.createElement("select",__assign({},o,{multiple:!1,id:u,name:u,defaultValue:f||a,"aria-label":u,ref:c}),React__default.createElement("option",{value:a,disabled:!0,hidden:!0},n),i.map(function(e){var t=e.id,r=e.title;return React__default.createElement("option",{key:t,value:t},r)})),p&&React__default.createElement("span",null,p))}function Input$1(e){var t=e.name,r=e.label,n=e.onStartProgress,a=__rest(e,["name","label","onStartProgress"]),i=React.useRef(null),o=useField(t),c=o.fieldName,l=o.registerField,u=o.defaultValue,s=o.error,f=React.useState(u),p=f[0],d=f[1];React.useEffect(function(){i.current&&l({name:c,ref:i.current,path:"dataset.file",clearValue:function(e){e.value="",d("")}})},[i.current,c]);var h=__assign({},a,{ref:i,id:c,name:c,"aria-label":c});return React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:c},r),React__default.createElement("input",__assign({},h,{type:"file",onChange:function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;d(t)},t.onprogress=function(e){var t=e.loaded,r=void 0===t?0:t,a=e.total;n&&n(r/(void 0===a?0:a)*100,e)};var r=e.target.files;r&&t.readAsDataURL(r[0])},"data-file":p})),s&&React__default.createElement("span",null,s))}function Input$2(e){var t=e.name,r=e.label,n=__rest(e,["name","label"]),a=React.useRef(null),i=useField(t),o=i.fieldName,c=i.registerField,l=i.defaultValue,u=i.error,s=function(e){return e.checked};React.useEffect(function(){a.current&&c({name:o,ref:a.current,path:"",parseValue:s,clearValue:function(e){e.checked=!1}})},[a.current,o]);var f=__assign({},n,{ref:a,id:o,name:o,type:"checkbox","aria-label":o,defaultChecked:l});return React__default.createElement(React__default.Fragment,null,React__default.createElement("input",__assign({},f)),r&&React__default.createElement("label",{htmlFor:o},r),u&&React__default.createElement("span",null,u))}function Choice(e){var t=e.name,r=e.options,n=e.multiple,a=__rest(e,["name","options","multiple"]),i=useField(t),o=i.fieldName,c=i.registerField,l=i.defaultValue,u=i.error,s=React.useRef([]),f=n?"checkbox":"radio",p=function(e){return!!l&&("string"==typeof l?[l].includes(e):Array.from(l).includes(e))},d=function(e){var t=e.filter(function(e){return e.checked}).map(function(e){return e.value});return n?t:t[0]};return React.useEffect(function(){s.current=s.current.slice(0,r.length),c({name:o,path:"",ref:s.current,parseValue:d,clearValue:function(e){e.forEach(function(e){e.checked=!1})}})},[o]),React__default.createElement(React.Fragment,null,r.map(function(e,t){var r=e.value,n=e.label,i=o+"-"+r;return React__default.createElement(React.Fragment,{key:i},React__default.createElement("input",__assign({},a,{ref:function(e){s.current[t]=e},type:f,id:i,name:o,"aria-label":i,value:r,defaultChecked:p(r)})),n&&React__default.createElement("label",{htmlFor:i},n))}),u&&React__default.createElement("span",null,u))}Select.defaultProps=defaultProps,exports.Check=Input$2,exports.Choice=Choice,exports.FileInput=Input$1,exports.Form=Form,exports.Input=Input,exports.Scope=Scope,exports.Select=Select,exports.Textarea=Textarea,exports.useField=useField;
//# sourceMappingURL=index.js.map
